****
# 优惠券管理
## 兑换码生成算法
在兑换码的指定发放的推广方式下，是使用兑换码来兑换优惠券，因此必须在优惠券发放的同时生成兑换码
### 兑换码的需求
* 可读性：因为兑换码是给用户使用的，用户输入兑换码获取优惠券，因此业务要求兑换码的可读性必须好：长度不超过10个字符，字符只能是24个大写字母和8个数字（去掉了IO和10）
* 数据量大：优惠活动频繁，必须有充足的兑换码，最好10亿以上的量
* 唯一性：10亿个兑换码都必须唯一，不能重复，否则会造成兑换混乱情况
* 不可重兑：兑换码只能兑换一次，避免重复兑换
* 防止爆刷：兑换码规律性不能很明显，不能轻易被人拆测到其他兑换码
* 高效：兑换码生成、验证的算法必须保证效率，避免对数据库带来较大的压力
### 兑换码生成算法
1. 利用Redis自增来生成序列号s，作为兑换码的唯一标识
2. 利用优惠券id后四位做新鲜值f，从密钥中列表中得到密钥
3. 拼接f和s，利用密钥加密，取后14位得到签名c
4. 将c、f、s拼接，利用Base32编码，得到最终兑换码

### 校验兑换码
1. 从要校验的兑换码中分别获取f，c，s
2. 再次利用生成算法，得到签名c2
3. 将c2与c比较，一致则认为是有效兑换码
4. 兑换码使用过后，利用BitMap标记序列号对应bit是否为1，用于下次校验兑换码是否已经使用过。



